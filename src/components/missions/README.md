# ğŸ“˜ Cahier des Charges - Gestion des Missions

## Vue d'ensemble

L'application intÃ¨gre dÃ©sormais un systÃ¨me complet de gestion des missions pour les techniciens et commerciaux. Le systÃ¨me remplace la gestion manuelle des missions et offre une traÃ§abilitÃ© complÃ¨te, de la crÃ©ation Ã  la clÃ´ture.

## ğŸ¯ Objectifs

âœ… CrÃ©ation, gestion et suivi des missions
âœ… Affectation des techniciens/commerciaux aux missions
âœ… Saisie des rapports techniques et des dÃ©penses
âœ… Suivi des dÃ©lais et budgets
âœ… Validation finale par le chef de mission et l'administrateur

## ğŸ“ Structure des Fichiers

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ missions/
â”‚       â”œâ”€â”€ MissionsList.jsx        # Composant principal avec liste et cahier des charges
â”‚       â”œâ”€â”€ MissionCard.jsx         # Carte affichant une mission
â”‚       â”œâ”€â”€ MissionForm.jsx         # Formulaire de crÃ©ation/Ã©dition
â”‚       â”œâ”€â”€ MissionDetails.jsx      # Vue dÃ©taillÃ©e d'une mission
â”‚       â””â”€â”€ MissionFinances.jsx     # Gestion des dÃ©penses et finances
â””â”€â”€ services/
    â””â”€â”€ missionService.js           # Service API pour les missions
```

## ğŸ”§ FonctionnalitÃ©s ImplÃ©mentÃ©es

### 1. CrÃ©ation et Gestion de Mission (Admin)

Une mission se crÃ©e avec les informations suivantes :

- **Informations GÃ©nÃ©rales**
  - Identifiant unique
  - Titre et description
  - Client associÃ©
  - Lieu de la mission
  - Dates de dÃ©but et fin prÃ©vues
  - Budget initial allouÃ©

- **Participants**
  - Affectation des techniciens
  - Affectation des commerciaux
  - RÃ´les et responsabilitÃ©s

- **Classification**
  - Type : Installation, Formation, Support, Maintenance, Audit
  - PrioritÃ© : Faible, Moyenne, Haute, Critique

- **Statuts de Mission**
  - ğŸ”µ CrÃ©Ã©e
  - ğŸ”µ PlanifiÃ©e
  - ğŸŸ  En cours
  - ğŸŸ¢ ClÃ´turÃ©e
  - ğŸŸ¢ ValidÃ©e
  - âš« ArchivÃ©e

### 2. Tableau de Bord & Suivi des DÃ©lais

Le tableau de bord affiche :

- **Vue Globale**
  - Total des missions
  - Missions en cours
  - Taux de complÃ©ment
  - Budget utilisÃ©

- **Filtres**
  - Par statut
  - Par type de mission
  - Par technicien/participant
  - Par client
  - Par dates

- **Code Couleur - Indicateur de DÃ©lai**
  - ğŸŸ¢ Vert : Dans les dÃ©lais
  - ğŸŸ  Orange : Ã€ risque (proche de l'Ã©chÃ©ance)
  - ğŸ”´ Rouge : Retard dÃ©passÃ©

### 3. Volet Technique

Chaque technicien peut saisir :

- Objectif de l'intervention
- Actions rÃ©alisÃ©es
- Logiciels installÃ©s
- MatÃ©riel utilisÃ©
- ProblÃ¨mes rencontrÃ©s
- Solutions apportÃ©es
- Ã‰valuation client (optionnel)
- Rapport technique final

*(Ã€ implÃ©menter dans la v2)*

### 4. Volet Financier â€“ Gestion des DÃ©penses

Suivi dÃ©taillÃ© des dÃ©penses par catÃ©gorie :

- ğŸš— Transport / Fuel
- ğŸ¨ HÃ´tel
- ğŸ½ï¸ Repas
- ğŸ“¦ Divers

**FonctionnalitÃ©s**
- Upload justificatifs (image, PDF, facture)
- GÃ©nÃ©ration automatique du bilan financier
- Alertes dÃ©passement budget
- DÃ©tails des dÃ©penses par type

### 5. ClÃ´ture & Validation

Processus de validation en plusieurs Ã©tapes :

| Action | Par qui |
|--------|---------|
| Validation technique | Chef de mission |
| VÃ©rification dÃ©penses | Administrateur / ComptabilitÃ© |
| Commentaires finaux | Administrateur |

Statut dÃ©finitif : ValidÃ©e / RefusÃ©e / Ã€ modifier

### 6. Reporting & Export

*Ã€ implÃ©menter dans la v2*

- Export PDF / Excel de la fiche mission
- Statistiques par technicien / client / type
- CoÃ»ts par mission / mois / client
- Analyse du respect des dÃ©lais (%)

## ğŸ’¾ Structures de DonnÃ©es (Supabase)

### Table: missions

```sql
CREATE TABLE missions (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  titre VARCHAR(255) NOT NULL,
  description TEXT,
  client_id BIGINT REFERENCES clients(id),
  lieu VARCHAR(255),
  date_debut DATE NOT NULL,
  date_fin DATE NOT NULL,
  budget_initial DECIMAL(10, 2),
  type_mission VARCHAR(50),
  priorite VARCHAR(20),
  statut VARCHAR(20) DEFAULT 'creee',
  avancement INTEGER DEFAULT 0,
  duree_prevue INTEGER,
  duree_reelle INTEGER,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### Table: missions_participants

```sql
CREATE TABLE missions_participants (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  mission_id BIGINT REFERENCES missions(id) ON DELETE CASCADE,
  user_id UUID REFERENCES auth.users(id),
  role VARCHAR(50),
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Table: missions_expenses

```sql
CREATE TABLE missions_expenses (
  id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  mission_id BIGINT REFERENCES missions(id) ON DELETE CASCADE,
  type_depense VARCHAR(50),
  montant DECIMAL(10, 2),
  description TEXT,
  justificatif_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT NOW()
);
```

## ğŸ”Œ IntÃ©gration dans l'Application

### Routes

La page Missions est accessible via :
- Sidebar : `Missions` (remplace `Interventions`)
- URL : `/missions`
- Page constante : `PAGES.INTERVENTIONS`

### Service API

Le service `missionService.js` fournit les mÃ©thodes suivantes :

```javascript
// CRUD
missionService.getAll()           // RÃ©cupÃ©rer toutes les missions
missionService.getById(id)        // RÃ©cupÃ©rer une mission
missionService.create(data)       // CrÃ©er une mission
missionService.update(id, data)   // Mettre Ã  jour
missionService.delete(id)         // Supprimer

// Gestion
missionService.updateStatus(id, statut)     // Changer le statut
missionService.addParticipant(...)          // Ajouter un participant
missionService.addExpense(missionId, data)  // Ajouter une dÃ©pense

// RequÃªtes
missionService.getByClient(clientId)        // Missions d'un client
missionService.getByParticipant(userId)     // Missions d'un utilisateur
missionService.getExpenses(missionId)       // DÃ©penses d'une mission
missionService.getStatistics(filters)       // Statistiques globales
```

## ğŸ¨ Composants

### MissionsList
- Composant principal
- Affiche la liste des missions avec filtres
- Vue Cahier des Charges intÃ©grÃ©e
- Vue Finances intÃ©grÃ©e

### MissionCard
- Carte affichant une mission
- Indicateur de dÃ©lai (code couleur)
- Informations rapides
- Actions : DÃ©tails, Modifier, Supprimer

### MissionForm
- Formulaire de crÃ©ation/Ã©dition
- Validation des donnÃ©es
- Champs : titre, client, dates, budget, type, etc.

### MissionDetails
- Vue dÃ©taillÃ©e d'une mission
- Sections pliables : GÃ©nÃ©ral, Technique, Financier
- Export PDF

### MissionFinances
- Suivi des dÃ©penses
- Gestion du budget
- Tableau des dÃ©penses
- Statistiques par type

## ğŸ” Permissions

Les permissions sont gÃ©rÃ©es par rÃ´le :

- **Admin/Super Admin** : AccÃ¨s complet
- **Chef de Mission** : Validation des missions
- **Technicien/Commercial** : Consultation et saisie de rapports
- **ComptabilitÃ©** : VÃ©rification des dÃ©penses

## ğŸ“Š Indicateurs de DÃ©lai

Les missions affichent un indicateur visuel basÃ© sur la date de fin :

```javascript
const daysLeft = (dueDateDate - today) / (1000 * 60 * 60 * 24);

if (daysLeft < 0) â†’ ğŸ”´ Rouge (Retard)
if (daysLeft â‰¤ 3) â†’ ğŸŸ  Orange (Ã€ risque)
else             â†’ ğŸŸ¢ Vert (Conforme)
```

## ğŸ“ˆ Statistiques

Le tableau de bord affiche en temps rÃ©el :

- Total des missions
- Nombre en cours
- Taux de complÃ©ment (missions validÃ©es / total)
- Budget total allouÃ©
- DÃ©penses totales
- Taux d'utilisation moyen du budget

## ğŸš€ Prochaines Ã‰tapes (v2)

- [ ] IntÃ©gration complÃ¨te avec Supabase
- [ ] Volet Technique avec rapports dÃ©taillÃ©s
- [ ] Upload justificatifs (stockage cloud)
- [ ] Export PDF/Excel automatique
- [ ] Notifications et alertes
- [ ] Statistiques avancÃ©es
- [ ] IntÃ©gration calendrier
- [ ] API pour applications externes
- [ ] Mobile responsive complÃ¨te
- [ ] Tests unitaires et d'intÃ©gration

## ğŸ“ Notes

- Les donnÃ©es affichÃ©es sont actuellement mockÃ©es
- Ã€ remplacer par les appels API rÃ©els au service `missionService`
- L'interface est responsive et compatible mobile
- Utilise Tailwind CSS pour le styling

---

**DerniÃ¨re mise Ã  jour :** 21 novembre 2025
